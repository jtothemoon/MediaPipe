<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>File Upload and Playback</title>
</head>
<body>
	<h1>Upload a Video File</h1>
	<form id="uploadForm" enctype="multipart/form-data">
		<input type="file" name="file" accept="video/*"> <br>
		<br>
		<button type="submit">Upload</button>
	</form>

	<h2>Uploaded Video Playback</h2>
	<video id="videoPlayer" width="600" controls style="display: none;">
		<source id="videoSource" src="" type="video/mp4">
		Your browser does not support the video tag.
	</video>

	<script>
	document.getElementById('uploadForm').onsubmit = async function(event) {
	    event.preventDefault();
	    const formData = new FormData(event.target);

	    try {
	        const response = await fetch('/upload', {
	            method: 'POST',
	            body: formData
	        });

	        if (response.ok) {
	            const responseText = await response.text();
	            console.log('Raw server response:', responseText);  // 서버 응답을 그대로 출력

	            // "Flask 서버로부터의 응답:" 부분을 제거
	            const jsonStartIndex = responseText.indexOf('{');
	            const jsonString = responseText.substring(jsonStartIndex);

	            let result;
	            try {
	                result = JSON.parse(jsonString);
	            } catch (e) {
	                console.error('JSON parsing error:', e);
	                alert('Failed to parse server response.');
	                return;
	            }

	            if (result.url) {
	                console.log('Parsed JSON:', result);  // 파싱된 JSON 출력
	                const videoPlayer = document.getElementById('videoPlayer');
	                const videoSource = document.getElementById('videoSource');
	                videoSource.src = result.url;
	                videoPlayer.style.display = 'block';
	                videoPlayer.load();  // 동영상 소스를 다시 로드
	            } else {
	                alert('Failed to retrieve video URL.');
	            }
	        } else {
	            console.error('Server responded with status:', response.status);
	            alert('Failed to upload the video. Server responded with status: ' + response.status);
	        }
	    } catch (error) {
	        console.error('Error during fetch:', error);
	        alert('An error occurred while uploading the video.');
	    }
	};



    </script>
</body>
</html>
